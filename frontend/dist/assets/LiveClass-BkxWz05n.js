const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D9lXXRMH.js","assets/index-lP4ZdarO.css"])))=>i.map(i=>d[i]);
import{r,j as e,W as le,S as ae,P as ne,A as re,a as ie,G as ce,B as de,M as ue,C as ge,b as me,u as he,c as ee,d as xe,e as ve,_ as be}from"./index-D9lXXRMH.js";import{webRTCClient as pe}from"./webRTCClient-V0-wP40F.js";import{s as fe}from"./offline-D748ZU6k.js";function Ce({kbps:i=24}){const[t,l]=r.useState(0),f=r.useRef(Date.now());r.useEffect(()=>{const m=setInterval(()=>{const z=(Date.now()-f.current)/1e3,g=i*1e3*z;l(g/8)},1e3);return()=>clearInterval(m)},[i]);const L=t/1024,v=L/1024,p=v>=.1?`${v.toFixed(2)} MB`:`${L.toFixed(0)} KB`,N=i*60*1e3/8/1024;return e.jsxs("span",{className:"inline-flex items-center gap-2 text-xs text-textMuted",children:[e.jsxs("span",{className:"badge",children:["~",Math.round(N)," KB/min"]}),e.jsxs("span",{className:"opacity-80",children:["Used: ",p]})]})}function ye({audioRef:i,className:t=""}){const l=r.useRef(null),f=r.useRef(null),L=r.useRef(null),v=r.useRef(0),p=r.useRef([]),N=r.useRef(null),m=r.useRef(null),z=r.useRef(null);return r.useEffect(()=>{var $,B;const g=l.current,A=new le({antialias:!0,alpha:!0});A.setPixelRatio(Math.min(2,window.devicePixelRatio||1)),A.setSize(g.clientWidth,g.clientHeight),g.appendChild(A.domElement),N.current=A;const C=new ae;z.current=C;const k=new ne(45,g.clientWidth/g.clientHeight,.1,100);k.position.z=5,m.current=k;const I=new re("#ffffff",.6),R=new ie("#7c3aed",2,8);R.position.set(0,2,2),C.add(I,R);const T=new ce;C.add(T);const M=48,W=1.6;for(let c=0;c<M;c++){const h=new de(.07,.4,.07),S=.72+c/M*.15,b=new ue({color:new ge().setHSL(S,.7,.55),metalness:.4,roughness:.35}),V=new me(h,b),x=c/M*Math.PI*2;V.position.set(Math.cos(x)*W,Math.sin(x)*W,0),V.lookAt(0,0,0),T.add(V),p.current.push(V)}function O(){const c=g.clientWidth,h=g.clientHeight;A.setSize(c,h),k.aspect=c/h,k.updateProjectionMatrix()}window.addEventListener("resize",O),O();function E(){T.rotation.z+=.003,A.render(C,k)}function H(){v.current=requestAnimationFrame(H);const c=L.current;if(c){const h=new Uint8Array(c.frequencyBinCount);c.getByteFrequencyData(h);const S=Math.floor(h.length/p.current.length);p.current.forEach((b,V)=>{const x=h[V*S]/255;b.scale.y=.6+x*2.2,b.material.emissiveIntensity=.3+x*1.4})}E()}let y;const D=()=>{if(!(f.current||!(i!=null&&i.current)))try{const c=new(window.AudioContext||window.webkitAudioContext),h=c.createAnalyser();h.fftSize=1024;const S=c.createMediaElementSource(i.current);S.connect(h),h.connect(c.destination),f.current=c,L.current=h,y=S}catch{}},w=()=>{var c;D(),((c=f.current)==null?void 0:c.state)==="suspended"&&f.current.resume()};return($=i==null?void 0:i.current)==null||$.addEventListener("play",w),(B=i==null?void 0:i.current)==null||B.addEventListener("canplay",w),H(),()=>{var c,h;if(cancelAnimationFrame(v.current),window.removeEventListener("resize",O),(c=i==null?void 0:i.current)==null||c.removeEventListener("play",w),(h=i==null?void 0:i.current)==null||h.removeEventListener("canplay",w),y)try{y.disconnect()}catch{}if(L.current)try{L.current.disconnect()}catch{}if(f.current)try{f.current.close()}catch{}A.dispose(),g.removeChild(A.domElement)}},[i]),e.jsx("div",{ref:l,className:`absolute inset-0 -z-10 ${t}`})}function Ae(){var Q,q,Y,_,Z,J,K;const{id:i}=he();console.log("[LiveClass] URL Parameter ID:",i),console.log("[LiveClass] Current URL:",window.location.href);const t=r.useRef(null),l=r.useRef(null),[f,L]=r.useState(!1),[v,p]=r.useState(!1),N=async()=>{if(t.current){const s=t.current;console.log("[LiveClass] Initializing audio element..."),console.log("[LiveClass] Initial audio state:",{volume:s.volume,muted:s.muted,paused:s.paused,readyState:s.readyState,src:s.src,srcObject:!!s.srcObject}),s.volume=1,s.muted=!1,console.log("[LiveClass] System audio check...");try{const o=new(window.AudioContext||window.webkitAudioContext),a=o.createOscillator(),u=o.createGain();a.connect(u),u.connect(o.destination),a.frequency.setValueAtTime(440,o.currentTime),u.gain.setValueAtTime(.1,o.currentTime),a.start(),a.stop(o.currentTime+.1),console.log("[LiveClass] Audio context test completed - if you heard a beep, audio is working"),o.close()}catch(o){console.error("[LiveClass] Audio context test failed:",o)}return L(!0),console.log("[LiveClass] Audio initialization complete"),s}},[m,z]=r.useState([]),[g,A]=r.useState([]),[C,k]=r.useState(0),[I,R]=r.useState([]),[T,M]=r.useState(""),[W,O]=r.useState(!1),[E,H]=r.useState(null),[y,D]=r.useState(!1),[w,$]=r.useState(""),[B,c]=r.useState(!1),[h,S]=r.useState("Live Class"),[b,V]=r.useState(!1),[x,U]=r.useState(!1);r.useEffect(()=>{(async()=>{var s;try{console.log("[LiveClass] About to fetch class data for ID:",i);const o=await ee.get(`/classes/${i}`);if(console.log("[LiveClass] API Response:",o),o.status==="ok"&&o.class){const a=o.class;console.log("[LiveClass] Class data:",a),console.log("[LiveClass] Slides array:",a.slides),console.log("[LiveClass] SlideAudio array:",a.slideAudio);const u=n=>n.split(".").pop().toLowerCase(),F=n=>{const j=u(n);return["jpg","jpeg","png","gif","webp"].includes(j)?"image":["pdf"].includes(j)?"pdf":["mp3","wav","ogg","m4a"].includes(j)?"audio":"unknown"},P=(a.slides||[]).map((n,j)=>({id:`slide-${j}`,filename:n.filename,url:`http://localhost:3000/storage/${n.filename}`,title:n.filename.split(".")[0]||`Slide ${j+1}`,type:F(n.filename),extension:u(n.filename)})),d=(a.slideAudio||[]).map((n,j)=>{console.log("[LiveClass] Raw audio data:",n);const X=`http://localhost:3000/storage/${n.audioFile}`;return console.log("[LiveClass] Constructed audio URL:",X),{id:`audio-${j}`,filename:n.audioFile.split("/").pop(),url:X,title:`Slide ${n.slideIndex} Audio`,type:"audio",extension:u(n.audioFile),slideIndex:n.slideIndex}});console.log("[LiveClass] Slide files:",P),console.log("[LiveClass] Audio files:",d),console.log("[LiveClass] Audio files URLs:",d.map(n=>n.url)),console.log("[LiveClass] First audio file URL:",(s=d[0])==null?void 0:s.url),z(P),A(d),S(a.title||"Live Class"),V(!!a.live),console.log("[LiveClass] Live status:",a.live),a.quiz&&H(a.quiz)}else console.error("[LiveClass] Invalid response format:",o)}catch(o){console.error("[LiveClass] Failed to fetch class data:",o)}})()},[i]),r.useEffect(()=>{if(console.log("[LiveClass] audioFiles state changed:",g),console.log("[LiveClass] teacherLive status:",b),console.log("[LiveClass] hasLiveStream status:",x),g.length>0&&t.current&&!b&&!x){const s=g[0];console.log("[LiveClass] Setting STATIC audio source to:",s.url),t.current.srcObject&&(console.log("[LiveClass] Clearing WebRTC stream before loading static audio"),t.current.srcObject=null),t.current.src!==s.url&&(t.current.pause(),t.current.src=s.url,t.current.load(),console.log("[LiveClass] Loaded static audio source"));const a=t.current.canPlayType('audio/ogg; codecs="vorbis"');console.log("[LiveClass] Browser OGG support:",a),setTimeout(()=>{t.current&&!b&&!x&&t.current.play().catch(u=>{console.log("[LiveClass] Auto-play failed (expected):",u.message)})},500)}else x&&t.current?t.current.src&&!t.current.srcObject&&(console.log("[LiveClass] Clearing static audio - live stream is active"),t.current.pause(),t.current.src="",t.current.load()):(b||x)&&console.log("[LiveClass] Live stream active - prioritizing live audio over static files")},[g,b,x]),r.useEffect(()=>{if(!b){console.log("[LiveClass] Teacher not live, using static audio"),D(!0),U(!1),p(!1);return}console.log("[LiveClass] Teacher is live, attempting WebRTC connection"),D(!1);const s=async()=>{const a=await be(()=>import("./index-D9lXXRMH.js").then(d=>d.h),__vite__mapDeps([0,1])),u=a.getAuthToken?await a.getAuthToken():"",F="ws://localhost:3000/ws";console.log("[LiveClass] Initializing WebRTC with URL:",F);const P=pe({wsUrl:F,token:u});return P.joinClass(i,d=>{if(console.log("[LiveClass] Received LIVE audio stream from teacher!",d),console.log("[LiveClass] Stream tracks:",d.getTracks()),console.log("[LiveClass] Audio tracks:",d.getAudioTracks()),console.log("[LiveClass] Video tracks:",d.getVideoTracks()),d.getVideoTracks().length>0&&(console.log("[LiveClass] *** AUDIO STREAM CONTAINS VIDEO TRACKS! ***"),p(!0),l.current))try{l.current.srcObject=d,l.current.play().then(()=>{console.log("[LiveClass] Video playback started from audio callback")}).catch(n=>{console.log("[LiveClass] Video play failed from audio callback:",n.message),c(!0)})}catch(n){console.log("[LiveClass] Failed to set video srcObject:",n)}d.getAudioTracks().forEach((n,j)=>{console.log(`[LiveClass] Audio track ${j}:`,{enabled:n.enabled,muted:n.muted,readyState:n.readyState,label:n.label,settings:n.getSettings()})}),t.current&&(t.current.pause(),t.current.src="",t.current.srcObject=null,t.current.load(),setTimeout(async()=>{t.current&&d&&(console.log("[LiveClass] Setting srcObject to remoteStream"),t.current.srcObject=d,await N(),t.current.volume=1,t.current.muted=!1,U(!0),console.log("[LiveClass] Switched to LIVE WebRTC stream"),t.current.play().then(()=>{console.log("[LiveClass] Audio playback started successfully")}).catch(n=>{console.log("[LiveClass] Live stream play failed (may need user interaction):",n.message),c(!0)}))},100))},d=>{console.log("[LiveClass] WebRTC event:",d),d==="webrtc-failed"&&(D(!0),U(!1),p(!1),console.log("[LiveClass] WebRTC failed - will fallback to static audio"))},d=>{console.log("[LiveClass] Received LIVE video stream from teacher!",d),console.log("[LiveClass] Video tracks:",d.getVideoTracks()),console.log("[LiveClass] Audio tracks in video stream:",d.getAudioTracks()),console.log("[LiveClass] All tracks in video stream:",d.getTracks()),d.getVideoTracks().forEach((n,j)=>{console.log(`[LiveClass] Video track ${j} details:`,{enabled:n.enabled,muted:n.muted,readyState:n.readyState,label:n.label,settings:n.getSettings(),constraints:n.getConstraints()})}),l.current?d.getVideoTracks().length>0?(console.log("[LiveClass] Setting video srcObject with stream containing video tracks"),l.current.srcObject=null,setTimeout(()=>{l.current.srcObject=d,p(!0),console.log("[LiveClass] Video element details after setting stream:",{videoWidth:l.current.videoWidth,videoHeight:l.current.videoHeight,readyState:l.current.readyState,paused:l.current.paused,currentTime:l.current.currentTime}),l.current.play().then(()=>{console.log("[LiveClass] Video playback started successfully"),console.log("[LiveClass] Video dimensions after play:",{videoWidth:l.current.videoWidth,videoHeight:l.current.videoHeight})}).catch(n=>{console.log("[LiveClass] Video play failed:",n.message),c(!0)})},100),console.log("[LiveClass] Video stream set to video element")):console.log("[LiveClass] No video tracks found in received stream"):console.log("[LiveClass] Video ref is null")}),P};let o;return s().then(a=>{o=a}).catch(a=>{console.error("[LiveClass] WebRTC initialization failed:",a),D(!0)}),()=>{console.log("[LiveClass] Cleaning up WebRTC connection"),U(!1),p(!1),o==null||o.leave()}},[i,b]),r.useEffect(()=>{y&&t.current&&w&&(console.log("[LiveClass] Switching to fallback audio:",w),t.current.pause(),t.current.srcObject=null,t.current.src=w,t.current.load(),setTimeout(async()=>{await N(),console.log("[LiveClass] Fallback audio initialized")},100))},[y,w]),r.useEffect(()=>{const s=o=>{o.key==="ArrowRight"&&k(a=>Math.min(a+1,m.length-1)),o.key==="ArrowLeft"&&k(a=>Math.max(a-1,0))};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[m.length]);const G=s=>{t.current&&s.url&&(t.current.src=s.url,t.current.load(),console.log("[LiveClass] Switching to audio:",s.title,s.url),t.current.play().catch(o=>{console.error("Error playing audio:",o)}))},se=()=>{var s,o;if(console.log("[LiveClass] Testing audio..."),console.log("[LiveClass] Audio ref:",t.current),console.log("[LiveClass] Available audio files:",g),console.log("[LiveClass] Audio element src:",(s=t.current)==null?void 0:s.src),console.log("[LiveClass] Audio element readyState:",(o=t.current)==null?void 0:o.readyState),g.length>0){const a=g[0];console.log("[LiveClass] Testing first audio file:",a),console.log("[LiveClass] Audio URL to test:",a.url),fetch(a.url,{method:"HEAD"}).then(u=>{console.log("[LiveClass] Audio file fetch test - Status:",u.status),console.log("[LiveClass] Audio file fetch test - Headers:",u.headers.get("content-type")),u.ok?G(a):alert(`Audio file not accessible. Status: ${u.status}`)}).catch(u=>{console.error("[LiveClass] Audio file fetch test failed:",u),alert("Failed to access audio file: "+u.message)})}else console.log("[LiveClass] No audio files available"),alert("No audio files available for this class")},te=()=>{if(T.trim()){const s={text:T,me:!0,time:new Date().toLocaleTimeString()};R([...I,s]),setTimeout(()=>{(T.toLowerCase().includes("question")||T.toLowerCase().includes("help"))&&R(o=>[...o,{text:"I'll address that in a moment. Keep following along!",me:!1,sender:"Teacher",time:new Date().toLocaleTimeString()}])},2e3),M("")}},oe=async s=>{try{if((await ee.post(`/quizzes/${E.id}/submit`,{answers:s,createdAt:Date.now()})).status!=="ok")throw new Error("fail");alert("Quiz submitted!")}catch{if(await fe({quizId:E.id,answers:s,createdAt:Date.now()}),"serviceWorker"in navigator&&navigator.serviceWorker.ready){const o=await navigator.serviceWorker.ready;"sync"in o&&o.sync.register("sync-quiz-submissions").catch(()=>{})}alert("Offline: saved for sync.")}O(!1)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{className:"btn-ghost",onClick:()=>window.history.back(),children:"← Back to Dashboard"}),e.jsx("h1",{className:"text-2xl font-bold",children:h})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-4",children:[e.jsxs("section",{className:"relative card p-4 lg:col-span-2 overflow-hidden",children:[e.jsx(ye,{audioRef:t}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"section-title",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[h,b&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-red-100 dark:bg-red-900/20 rounded-full text-xs",children:[e.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-red-700 dark:text-red-300 font-medium",children:"LIVE"})]}),b&&e.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs ${x?"bg-green-100 dark:bg-green-900/20":y?"bg-yellow-100 dark:bg-yellow-900/20":"bg-blue-100 dark:bg-blue-900/20"}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${x?"bg-green-500":y?"bg-yellow-500":"bg-blue-500 animate-pulse"}`}),e.jsx("span",{className:`font-medium ${x?"text-green-700 dark:text-green-300":y?"text-yellow-700 dark:text-yellow-300":"text-blue-700 dark:text-blue-300"}`,children:x?"CONNECTED":y?"STATIC AUDIO":"CONNECTING..."})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ce,{kbps:24}),e.jsx(xe,{}),E&&e.jsx("button",{className:"btn ml-2",onClick:()=>O(!0),children:"Take Quiz"})]})]}),e.jsx("audio",{ref:t,controls:!0,className:"w-full mt-2",preload:"metadata",autoPlay:!0,playsInline:!0,volume:1,onLoadedData:s=>{var o,a,u;console.log("[LiveClass] Audio loaded data:",{duration:s.target.duration,readyState:s.target.readyState,srcObject:!!s.target.srcObject,tracks:((u=(a=(o=s.target.srcObject)==null?void 0:o.getTracks)==null?void 0:a.call(o))==null?void 0:u.length)||0})},onCanPlay:s=>{console.log("[LiveClass] Audio can play:",{paused:s.target.paused,muted:s.target.muted,volume:s.target.volume})},onPlay:()=>console.log("[LiveClass] Audio started playing"),onPause:()=>console.log("[LiveClass] Audio paused"),onVolumeChange:s=>console.log("[LiveClass] Volume changed:",s.target.volume),onError:s=>{var o,a;console.log("[LiveClass] Audio error:",s),console.log("[LiveClass] Audio src:",s.target.src),console.log("[LiveClass] Available audio files:",g),console.log("[LiveClass] httpAudio:",w),console.log("[LiveClass] Audio error code:",(o=s.target.error)==null?void 0:o.code),console.log("[LiveClass] Audio error message:",(a=s.target.error)==null?void 0:a.message)},onLoadStart:()=>{console.log("[LiveClass] Audio load started")},children:"Your browser does not support the audio element."}),v&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-bold mb-2",children:"📺 Teacher's Screen"}),e.jsx("video",{ref:l,controls:!0,className:"w-full max-h-96 bg-gray-900 rounded border-2 border-green-500",autoPlay:!0,playsInline:!0,muted:!0,onLoadedData:()=>console.log("[LiveClass] Video loaded"),onPlay:()=>console.log("[LiveClass] Video started playing"),onError:s=>console.log("[LiveClass] Video error:",s),onLoadedMetadata:s=>{console.log("[LiveClass] Video metadata loaded"),console.log("[LiveClass] Video dimensions:",s.target.videoWidth,"x",s.target.videoHeight)},onCanPlay:()=>console.log("[LiveClass] Video can play"),style:{minHeight:"200px"},children:"Your browser does not support the video element."}),e.jsxs("div",{className:"mt-2 p-2 bg-blue-100 dark:bg-blue-900 rounded text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Video Status:"})," ",v?"Active":"No Video"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Element Ready:"})," ",((Q=l.current)==null?void 0:Q.readyState)||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Dimensions:"})," ",((q=l.current)==null?void 0:q.videoWidth)||0," x ",((Y=l.current)==null?void 0:Y.videoHeight)||0]}),e.jsx("button",{onClick:()=>{if(l.current){const s=l.current.srcObject;s?(console.log("[Debug] Video stream tracks:",s.getTracks()),console.log("[Debug] Video tracks:",s.getVideoTracks()),console.log("[Debug] Video element properties:",{videoWidth:l.current.videoWidth,videoHeight:l.current.videoHeight,currentSrc:l.current.currentSrc,readyState:l.current.readyState,paused:l.current.paused,muted:l.current.muted,currentTime:l.current.currentTime,duration:l.current.duration}),l.current.play().then(()=>{console.log("[Debug] Force play successful")}).catch(o=>{console.log("[Debug] Force play failed:",o)})):console.log("[Debug] No stream object on video element")}},className:"px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600",children:"Debug Video"})]})]}),b&&!v&&e.jsxs("div",{className:"mt-4 p-3 bg-yellow-100 dark:bg-yellow-900 rounded",children:[e.jsx("p",{className:"text-sm",children:"📺 Waiting for screen sharing from teacher..."}),e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:["Status: ",x?"Audio connected, waiting for video":"Connecting to teacher..."]})]}),b&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded",children:[e.jsx("h5",{className:"font-bold text-sm mb-2",children:"🔍 WebRTC Debug Info"}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Audio Connection:"})," ",x?"✅ Connected":"❌ Not connected"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Video Connection:"})," ",v?"✅ Connected":"❌ Not connected"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"WebRTC Failed:"})," ",y?"❌ Yes":"✅ No"]}),e.jsx("button",{onClick:()=>{if(console.log("[Debug] Current state:",{hasLiveStream:x,hasVideo:v,webrtcFailed:y,teacherLive:b,audioElement:t.current?{srcObject:!!t.current.srcObject,src:t.current.src,paused:t.current.paused,volume:t.current.volume,tracks:t.current.srcObject?t.current.srcObject.getTracks().map(s=>({kind:s.kind,label:s.label,enabled:s.enabled,readyState:s.readyState})):[]}:null,videoElement:l.current?{srcObject:!!l.current.srcObject,videoWidth:l.current.videoWidth,videoHeight:l.current.videoHeight,paused:l.current.paused}:null}),t.current&&t.current.srcObject){const s=t.current.srcObject;console.log("[Debug] Audio stream analysis:",{totalTracks:s.getTracks().length,audioTracks:s.getAudioTracks().length,videoTracks:s.getVideoTracks().length,allTracks:s.getTracks().map(o=>({kind:o.kind,label:o.label,enabled:o.enabled}))}),s.getVideoTracks().length>0&&(console.log("[Debug] Found video tracks in audio stream! Setting to video element..."),l.current&&(l.current.srcObject=s,p(!0),console.log("[Debug] Video element updated with stream from audio")))}},className:"mt-2 px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600",children:"Log Debug Info"}),e.jsx("button",{onClick:()=>{if(console.log("[Debug] Forcing video check..."),t.current&&t.current.srcObject){const s=t.current.srcObject,o=s.getVideoTracks();console.log("[Debug] Video tracks in audio stream:",o.length),o.length>0?(console.log("[Debug] Video tracks found! Setting hasVideo to true"),p(!0),l.current&&(l.current.srcObject=s,l.current.play().catch(a=>console.log("[Debug] Video play failed:",a)))):console.log("[Debug] No video tracks in current stream")}else console.log("[Debug] No audio stream available")},className:"mt-1 px-2 py-1 bg-green-500 text-white rounded text-xs hover:bg-green-600",children:"Force Video Check"})]})]}),e.jsxs("div",{className:"mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded",children:[e.jsx("h4",{className:"font-bold mb-2",children:"🔊 Audio Debug Panel"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("button",{onClick:N,className:"px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600",children:"Initialize Audio"}),e.jsx("button",{onClick:()=>{t.current&&(t.current.volume=1,t.current.muted=!1,console.log("[LiveClass] Force unmuted and volume=1.0"))},className:"px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600",children:"Force Unmute"}),e.jsx("button",{onClick:()=>{t.current&&(t.current.src||t.current.srcObject)&&t.current.play().then(()=>{console.log("[LiveClass] Manual play successful")}).catch(s=>{console.log("[LiveClass] Manual play failed:",s.message)})},className:"px-3 py-1 bg-purple-500 text-white rounded text-sm hover:bg-purple-600",children:"Force Play"}),e.jsx("button",{onClick:async()=>{console.log("[LiveClass] Running comprehensive audio test...");try{const s=new(window.AudioContext||window.webkitAudioContext);console.log("[LiveClass] AudioContext state:",s.state),s.state==="suspended"&&(await s.resume(),console.log("[LiveClass] AudioContext resumed"));const o=s.createOscillator(),a=s.createGain();o.connect(a),a.connect(s.destination),o.frequency.setValueAtTime(880,s.currentTime),a.gain.setValueAtTime(.3,s.currentTime),o.start(),o.stop(s.currentTime+.5),console.log("[LiveClass] Test beep played - did you hear it?"),setTimeout(()=>{const u=new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmAUA0GO2Ou8cB4FNYzT8M2AOQkNZrrr55JMDR1Nnunn0xhMczkgqOG5rGMcBzaZ3u3AaSEGOnLR89eTQQoUZrXr4qhRFAhHot/nvWITAz+M1OSXJIHi2Lz6wBcQ");u.volume=.5,u.play().then(()=>{console.log("[LiveClass] HTML Audio test successful")}).catch(F=>{console.log("[LiveClass] HTML Audio test failed:",F.message)})},600),s.close()}catch(s){console.error("[LiveClass] Audio test failed:",s),alert("Audio test failed: "+s.message)}},className:"px-3 py-1 bg-orange-500 text-white rounded text-sm hover:bg-orange-600",children:"Audio Test"})]}),e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:["Status: ",f?"✅ Initialized":"❌ Not initialized"," | Volume: ",((_=t.current)==null?void 0:_.volume)||"N/A"," | Muted: ",(Z=t.current)!=null&&Z.muted?"Yes":"No"," | Source: ",(J=t.current)!=null&&J.src?"File":(K=t.current)!=null&&K.srcObject?"Stream":"None"]})]}),B&&e.jsx("div",{className:"fixed inset-0 flex items-end sm:items-center justify-center p-4 pointer-events-none",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 border border-border rounded p-4 shadow-lg pointer-events-auto",children:[e.jsx("p",{className:"mb-2 font-semibold",children:"Enable audio"}),e.jsx("p",{className:"text-sm text-textMuted mb-3",children:"Your browser blocked autoplay. Click below to enable live audio."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-green-500 text-white",onClick:async()=>{try{await N(),t.current&&(await t.current.play(),console.log("[LiveClass] Audio enabled via user gesture"),c(!1))}catch(s){console.log("[LiveClass] Enabling audio failed:",s),alert("Failed to enable audio: "+(s.message||s))}},children:"Enable Audio"}),e.jsx("button",{className:"btn",onClick:()=>c(!1),children:"Dismiss"})]})]})}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("button",{onClick:se,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"🔊 Test Audio"}),e.jsx("button",{onClick:()=>{t.current&&(console.log("[LiveClass] Manual play attempt"),console.log("[LiveClass] Audio src:",t.current.src),console.log("[LiveClass] Audio readyState:",t.current.readyState),t.current.play().catch(s=>{console.error("[LiveClass] Manual play failed:",s),alert("Play failed: "+s.message)}))},className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600",children:"▶️ Force Play"}),e.jsx("button",{onClick:()=>{if(t.current&&g.length>0){const s=g[0].url;console.log("[LiveClass] Manual load:",s),t.current.src=s,t.current.load()}},className:"px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600",children:"🔄 Reload"})]}),g.length===0&&!w&&e.jsx("div",{className:"mt-2 p-3 bg-yellow-100 dark:bg-yellow-900/20 rounded border",children:e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:"⚠️ No audio available for this class. The teacher may start live audio soon."})}),e.jsxs("div",{className:"mt-4 grid grid-cols-4 gap-2",children:[m.map((s,o)=>e.jsxs("button",{onClick:()=>k(o),className:`border border-border rounded overflow-hidden card-hover ${o===C?"ring-2 ring-accent":""}`,children:[s.type==="image"?e.jsx("img",{loading:"lazy",src:s.url,alt:s.title,className:"w-full h-20 object-cover"}):s.type==="pdf"?e.jsx("div",{className:"w-full h-20 bg-red-100 flex items-center justify-center",children:e.jsx("span",{className:"text-red-600 text-xs font-bold",children:"PDF"})}):e.jsx("div",{className:"w-full h-20 bg-gray-100 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-600 text-xs",children:s.extension.toUpperCase()})}),e.jsx("div",{className:"text-[11px] text-textMuted px-2 py-1 text-left truncate",children:s.title})]},s.id)),!m.length&&e.jsx("div",{className:"text-sm text-textMuted",children:"No files found."})]}),e.jsx("div",{className:"mt-4",children:m[C]?e.jsx("div",{children:m[C].type==="image"?e.jsx("img",{loading:"lazy",src:m[C].url,alt:"",className:"w-full max-h-[420px] object-contain rounded border border-border"}):m[C].type==="pdf"?e.jsxs("div",{className:"border border-border rounded p-6 text-center",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("span",{className:"text-red-600 text-4xl",children:"📄"}),e.jsx("h3",{className:"text-lg font-semibold mt-2",children:m[C].title}),e.jsx("p",{className:"text-textMuted text-sm",children:"PDF Document"})]}),e.jsx("a",{href:m[C].url,target:"_blank",rel:"noopener noreferrer",className:"btn",children:"📖 Open PDF"})]}):e.jsx("div",{className:"border border-border rounded p-6 text-center text-textMuted",children:e.jsxs("p",{children:["Unsupported file type: ",m[C].extension]})})}):e.jsx("div",{className:"border border-border rounded p-6 text-center text-textMuted",children:"Files will appear here"})}),g.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"📢 Audio Files"}),e.jsx("div",{className:"space-y-3",children:g.map((s,o)=>e.jsxs("div",{className:"border border-border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-sm",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>G(s),className:"px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600",children:"Play Main"}),e.jsx("span",{className:"text-xs text-textMuted",children:s.extension.toUpperCase()})]})]}),e.jsxs("audio",{controls:!0,className:"w-full",children:[e.jsx("source",{src:s.url,type:`audio/${s.extension}`}),"Your browser does not support the audio element."]})]},o))})]}),e.jsx("div",{className:"mt-2 text-xs text-textMuted",children:"Tip: Use ← → to navigate slides."})]})]}),e.jsxs("aside",{className:"card p-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Chat"}),e.jsx("div",{className:"h-64 overflow-y-auto scrollbar-thin space-y-2 border border-border rounded p-2",children:I.length===0?e.jsx("div",{className:"text-sm text-textMuted opacity-70",children:"No messages yet. Say hi to your class!"}):I.map((s,o)=>e.jsxs("div",{className:`text-sm p-2 rounded ${s.me?"bg-blue-100 dark:bg-blue-900/20 ml-4":"bg-gray-100 dark:bg-gray-800 mr-4"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-medium",children:s.me?"You":s.sender||"Teacher"}),s.time&&e.jsx("span",{className:"text-xs text-textMuted",children:s.time})]}),e.jsx("div",{className:s.me?"text-blue-700 dark:text-blue-300":"text-textMuted",children:s.text})]},o))}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("input",{className:"input flex-1",placeholder:"Say hi...",value:T,onChange:s=>M(s.target.value)}),e.jsx("button",{className:"btn",onClick:te,children:"Send"})]})]}),W&&E&&e.jsx(je,{quiz:E,onClose:()=>O(!1),onSubmit:oe}),e.jsx(ve,{})]})]})}function je({quiz:i,onClose:t,onSubmit:l}){const[f,L]=r.useState({});return e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center",children:e.jsxs("div",{className:"card p-5 w-full max-w-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold",children:i.title}),e.jsx("button",{className:"text-textMuted",onClick:t,children:"✕"})]}),e.jsx("div",{className:"mt-3 space-y-4",children:i.questions.map((v,p)=>e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm mb-2",children:[p+1,". ",v.text]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:v.options.map((N,m)=>e.jsxs("label",{className:`border border-border rounded px-2 py-1 cursor-pointer ${f[v.id]===m?"bg-accent text-black":""}`,children:[e.jsx("input",{type:"radio",className:"hidden",name:v.id,onChange:()=>L({...f,[v.id]:m})}),N]},m))})]},v.id))}),e.jsx("button",{className:"btn mt-4",onClick:()=>l(f),children:"Submit"})]})})}export{Ae as default};
